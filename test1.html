<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sirdata CMP 示例</title>

    <!-- 添加 Sirdata CMP 安装代码 -->
    <script data-cfasync="false" src="https://cache.consentframework.com/js/pa/43928/c/OMJpR/stub" referrerpolicy="unsafe-url" charset="utf-8" type="text/javascript"></script>
    <script data-cfasync="false" src="https://choices.consentframework.com/js/pa/43928/c/OMJpR/cmp" referrerpolicy="unsafe-url" async></script>

    <!-- Google 同意模式设置 -->
    <script>
        // 定义 dataLayer 和 gtag 函数
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}

        // 为特定区域设置默认同意（根据要求定义区域代码，如欧盟国家）
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied',
            'regions': ['FR', 'DE', 'IT'] // 替换为适当的 ISO 3166-2 区域代码
        });

        // 为所有其他区域设置默认同意
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied'
        });
    </script>
</head>
<body>
  <button id="promptConsentUI" class="btn" on="tap:consent.prompt(consent=sirdata)" role="button">我的同意选项</button>
</body>
<script>
  // 定义处理CMP结果的函数
  function logConsentData() {
    window.__tcfapi("getTCData", 2, function (tcData, success) {
      if (!success) {
        console.log("无法获取 TCData");
        return;
      }

      // 输出TC String
      console.log("TC String: ", tcData.tcString);

      // 判断是否适用GDPR
      if (!tcData.gdprApplies) {
        console.log("GDPR 不适用");
      }

      // 输出所有 consent 状态和合法利益状态
      console.log("Vendor Consents: ", tcData.vendor.consents);
      console.log("Vendor Legitimate Interests: ", tcData.vendor.legitimateInterests);
      console.log("Purpose Consents: ", tcData.purpose.consents);
      console.log("Purpose Legitimate Interests: ", tcData.purpose.legitimateInterests);

      // 检查不同 SDK 的 consent 状态，例如 Google 和其他第三方
      const sdkVendorIds = [755, 597, 1316, 9, 8]; // 这些是你提供的 SDK ID
      sdkVendorIds.forEach((vendorId) => {
        console.log(`Vendor ID ${vendorId} 的 consent 状态: `, tcData.vendor.consents[vendorId]);
        console.log(`Vendor ID ${vendorId} 的合法利益状态: `, tcData.vendor.legitimateInterests[vendorId]);
      });
    });
  }

  // 当用户确认或重新确认他们的选择时，监听并输出TC Data
  window.__tcfapi("addEventListener", 2, function (tcData, success) {
      console.log('1')
    if (success) {
      console.log("用户操作完成，输出 TC Data");
      logConsentData();
    }
  });

  // 页面加载完成时，也获取一次当前的 consent 状态
  window.addEventListener('load', logConsentData);
</script>

</html>

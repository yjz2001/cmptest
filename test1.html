<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sirdata CMP Example</title>
    <!-- Add the Sirdata CMP scripts -->
    <script type="text/javascript">
        // Set SameSite attribute for cookies
        document.cookie = "CookieConsent=1; SameSite=None; Secure";
        
        window.__cmp = (function () {
            window.addEventListener('message', function (event) {
                window.__cmp.receiveMessage(event);
            });

            var commandQueue = [];
            var cmp = function (command, parameter, callback) {
                commandQueue.push({
                    command: command,
                    parameter: parameter,
                    callback: callback
                });
            };
            cmp.commandQueue = commandQueue;
            cmp.receiveMessage = function (event) {
                var data = event && event.data && event.data.__cmpCall;
                if (data) {
                    commandQueue.push({
                        callId: data.callId,
                        command: data.command,
                        parameter: data.parameter,
                        event: event
                    });
                }
            };
            cmp.gdprAppliesGlobally = true;
            return cmp;
        }());
    </script>
    <script data-cfasync="false" src="https://cache.consentframework.com/js/pa/43928/c/OMJpR/stub" referrerpolicy="unsafe-url" charset="utf-8" type="text/javascript"></script>
    <script data-cfasync="false" src="https://choices.consentframework.com/js/pa/43928/c/OMJpR/cmp" referrerpolicy="unsafe-url" charset="utf-8" type="text/javascript" async></script>
</head>
<body>
    <!-- Button to log message and reopen CMP -->
    <div>hello</div>
    <button id="cmpButton" onclick="handleButtonClick()">Open CMP</button>

    <script>
        // Function to handle button click
        function handleButtonClick() {
            console.log('1');
            if (typeof window.__cmp === 'function') {
                window.__cmp('showConsentTool');
            } else {
                console.error('__cmp is not available');
            }
        }

        // Function to log TCData and TCString
        function logTCData() {
            if (typeof window.__tcfapi === 'function') {
                window.__tcfapi('getTCData', 2, function(tcData, success) {
                    if (success) {
                        console.log("TCData:", tcData);
                        console.log("TCString:", tcData.tcString);
                    }
                });
            } else {
                console.error('__tcfapi is not available');
            }
        }

        // Wait for CMP to be ready
        function waitForCMP() {
            if (typeof window.__cmp === 'function') {
                window.__cmp('addEventListener', 'cmpReady', function() {
                    console.log('CMP is ready');
                    logTCData();
                });
            } else {
                setTimeout(waitForCMP, 50);
            }
        }

        // Start waiting for CMP
        waitForCMP();

        // Add event listener to log TCString when user changes privacy settings
        if (typeof window.__tcfapi === 'function') {
            window.__tcfapi('addEventListener', 2, function(tcData, success) {
                if (success) {
                    console.log("Updated TCString:", tcData.tcString);
                }
            });
        }

        // Check if in an iframe and send postMessage if necessary
        if (window.self !== window.top) {
            window.parent.postMessage({
                __cmpCall: {
                    command: 'getConsentData',
                    parameter: null,
                    callId: 'iframe'
                }
            }, '*');
        }
    </script>
</body>
</html>

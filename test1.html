<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sirdata CMP 示例</title>

    <!-- Sirdata CMP 安装标签 -->
    <script data-cfasync="false" src="https://cache.consentframework.com/js/pa/43928/c/OMJpR/stub" referrerpolicy="unsafe-url" charset="utf-8" type="text/javascript"></script>
    <script data-cfasync="false" src="https://choices.consentframework.com/js/pa/43928/c/OMJpR/cmp" referrerpolicy="unsafe-url" charset="utf-8" async></script>

    <!-- 设置页面初始化逻辑，防止默认加载合作伙伴脚本 -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }

        // 设置合作伙伴列表，默认不允许广告存储等内容
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'analytics_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'regions': ['EU'] // 可根据需要设置不同区域
        });
    </script>
</head>
<body>
    <h1>Sirdata CMP 示例页面</h1>

    <!-- 用户选择后显示CMP的Consent信息 -->
    <button id="showConsentChoices" class="btn">显示我的选择</button>

    <script>
        // 用户点击按钮时显示CMP的UI
        document.getElementById('showConsentChoices').addEventListener('click', function() {
            Sddan.cmp.displayUI();
        });

        // Sirdata CMP加载完成后，获取用户的TC数据并输出到控制台
        window.__tcfapi = window.__tcfapi || function() {};
        
        window.__tcfapi('addEventListener', 2, function(tcData, success) {
            if (success) {
                console.log("监听器已添加，ID: " + tcData.listenerId);
                console.log("当前事件状态: " + tcData.eventStatus);
            }
        });

        // 获取并输出用户TC Data的详细信息
        window.__tcfapi("getTCData", 2, function (tcData, success) {
            if (success) {
                console.log("GDPR适用: " + tcData.gdprApplies);
                console.log("TC String: " + tcData.tcString);

                // 输出所有的consent状态
                console.log("合作伙伴consent: ", tcData.vendor.consents);
                console.log("目的consent: ", tcData.purpose.consents);
                console.log("合法利益: ", tcData.purpose.legitimateInterests);
            } else {
                console.log("无法获取TC数据");
            }
        });
    </script>
</body>
</html>
